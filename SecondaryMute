/**
 * A small In-Room controls panel to simulate a secondary mute button
 * Counts how many time widget is clicked (displayed on console)
 * 
 * ERROR: Counts ALL widgets pressed
 * 
 */
const xapi = require('xapi');

var i = 0;
// These match the widget id of the In-Room control buttons
const numbers = {
  muteButton: 'Testing Buttons',
};

function alert(title, text = '', duration = 5) {
  xapi.command('UserInterface Message Alert Display', {
    Title: title,
    Text: text,
    Duration: duration,
  });
}

function setMute(mute) {
  xapi.command(mute ? 'Audio Microphones Mute' : 'Audio Microphones Unmute');
}

//Modulo is used to switch between muted and unmuted modes. Even times pressed = mute, odd = unmute
function listenToGui() {
  xapi.event.on('UserInterface Extensions Widget Action', (event) => {
    if(event.Type === 'clicked'){
      const number = numbers[event.WidgetId];       //Only account for widgets in "numbers" array
       if(number){
        if(i%2 === 0){
           setMute(true);
           i++;
           console.log(i);
        }
        else{
           setMute(false);
           i++;
           console.log(i);
        }
       }
    }
  });
}

listenToGui();
